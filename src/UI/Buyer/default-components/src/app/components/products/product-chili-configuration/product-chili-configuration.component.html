<!--<script src="https://chili.accuconnect.com/CHILI/scripts/index.js"></script>
<script src="https://www.acculync.com/four51/scripts/nd_451_enc.js"></script>-->
<div class="container-fluid mt-4"
     *ngIf="_product"
     [hidden]="isLoading">
  <div class="row mb-5">
    <div class="col-md-6">
      <div [hidden]="ShowAddToCart">
        <iframe id="editor-iframe" class="chili-frame" [src]="frameSrc" frameborder="0"></iframe>
      </div>
      <div [hidden]="!ShowAddToCart">
      <img id="proof-image" class="chili-proof" [src]="lineImage" />
    </div>
    </div>
    <div class="col-md-6">
      <div [hidden]="ShowAddToCart">
        <div class="card-body">
          <form ngNoForm>
            <div *ngFor="let spec of chiliTemplate.TemplateSpecs; let i = index">
              <div *ngIf="spec.xp.UI.ControlType == 'Text'">
                <label>{{spec.Name}}</label>
                <input class="form-control" type='text' name="{{spec.Name}}" id="{{spec.ID}}" placeholder="{{spec.Name}}" (change)="setTecraSpec($event, spec)">
              </div>
              <div *ngIf="spec.xp.UI.ControlType == 'DropDown'">
                <label>{{spec.Name}}</label>
                <select class="form-control"
                        (change)="setTecraSpec($event, spec)">
                  <option selected
                          [ngValue]="null">
                    Select
                  </option>
                  <option *ngFor="let option of spec.Options"
                          [value]="option.Value">
                    {{option.Value}}
                  </option>
                </select>
              </div>
            </div>
          </form>
        </div>
        <div class="card-footer">
          <button class="btn btn-block btn-secondary mb-3"
                  (click)="saveTecraDocument()">
            Save and Continue
          </button>
          <div class="mb-3">
            <a class="btn btn-block btn-dark" href="products/{{_product.ID}}">Back To Product</a>
          </div>
        </div>
      </div>
      <!--Add To Cart-->
      <div *ngIf="ShowAddToCart">
        <div>
          <div>
            <!--<div class="d-flex justify-content-between align-items-center">
              <h4 *ngIf="!showGrid"
                  class="font-weight-bold">
                {{ _price  | currency: _userCurrency}}
              </h4>
              <p *ngIf="!showGrid"
                 class="text-muted ml-3 float-right">{{ _product | UofM }}</p>--> <!-- TODO: Plug in unit of measure when data is in OC. -->
              <!--<span class="badge badge-pill badge-warning"
                    *ngIf="percentSavings > 0">
                <span translate>PRODUCTS.DETAILS.SAVINGS</span> {{ percentSavings }}%!
              </span>
            </div>-->
            <!--DISPLAY SHORT SPEC FORM -->
            <div *ngIf="(specLength < 4 && !showGrid)">
              <ocm-spec-form *ngIf="isOrderable && _specs?.Items?.length > 0"
                             [superProduct]="_superProduct"
                             [specs]="_specs"
                             [currency]="_product?.xp?.Currency"
                             (specFormChange)="onSpecFormChange($event.detail)">
              </ocm-spec-form>
              <div class="d-flex flex-column"
                   *ngIf="isOrderable">
                <span translate>PRODUCTS.DETAILS.QUANTITY</span>
                <div class="d-flex flex-row">
                  <ocm-quantity-input class="d-inline-block mb-3 mr-3"
                                      (qtyChange)="qtyChange($event.detail)"
                                      [product]="_product"
                                      [priceSchedule]="_priceSchedule"
                                      [gridDisplay]="showGrid">
                  </ocm-quantity-input>
                  <button *ngIf="isQuoteProduct()"
                          class="btn btn-block btn-primary mb-3"
                          [disabled]="!specFormService.event?.valid || !qtyValid"
                          (click)="openQuoteForm()"
                          translate>
                    PRODUCTS.DETAILS.REQ_QUOTE
                  </button>
                  <button *ngIf="!isQuoteProduct()"
                          class="btn btn-block btn-primary mb-3"
                          type="submit"
                          [disabled]="this.isAddingToCart || !this.specFormService.event?.valid || !this.qtyValid || !pdfSrc"
                          (click)="addToCart()"
                          translate>
                    PRODUCTS.DETAILS.ADD_TO_CART
                    <!-- <span class="badge badge-light ml-2">{{ price | currency }}</span> -->
                  </button>
                </div>
                <div>
                  <ocm-modal [state]="quoteFormModal"
                             [modalTitle]="'Request Quote'">
                    <ocm-quote-request-form (formSubmitted)="submitQuoteOrder($event.detail.user)"
                                            [CurrentUser]="currentUser"
                                            (formDismissed)="dismissQuoteForm()"></ocm-quote-request-form>
                  </ocm-modal>
                </div>
              </div>
              <div *ngIf="!isOrderable"
                   class="alert alert-info"
                   translate>
                PRODUCTS.DETAILS.VIEW_ONLY
              </div>
            </div>
            <div *ngIf="showGrid">
              <ocm-grid-spec-form *ngIf="isOrderable && _specs.Items.length > 0"
                                  [specs]="_specs"
                                  [superProduct]="_superProduct"
                                  [product]="_product"
                                  [priceSchedule]="_priceSchedule">
              </ocm-grid-spec-form>
            </div>
          </div>
        </div>
        <div *ngIf="_priceBreaks && _priceBreaks.length > 1">
          <strong><span translate>PRODUCTS.DETAILS.TIERED_PRICE_HEAD</span>: </strong>
          <div class=" border border-medium border-radius mb-3 p-2">
            <span translate>PRODUCTS.DETAILS.TIERED_PRICE_DESC</span>
            <div class="d-flex flex-row">
              <span *ngFor="let priceBreak of _priceBreaks; let i = index"
                    class="font-weight-bold d-flex mt-2">
                {{ getPriceBreakRange(i) }}:
                <p class="font-weight-normal ml-1 mr-4">{{priceBreak?.Price | currency: _userCurrency}}</p>
              </span>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <div class="mb-3" *ngIf="pdfSrc">
            <a class="btn btn-block btn-info" [href]="pdfSrc" target="_blank">Download PDF</a>
          </div>
          <button class="btn btn-block btn-secondary mb-3"
                  (click)="ShowAddToCart = !ShowAddToCart">
            Edit Document
          </button>
          <div class="mb-3">
            <a class="btn btn-block btn-dark" href="products/{{_product.ID}}">Back To Product</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div [hidden]="!isLoading">
  <ocm-loading-layout height="750px"
                      width="100%"
                      mb="1.5rem"
                      [rows]="3"
                      [columns]="3"
                      [isLoading]="isLoading"></ocm-loading-layout>

</div>
