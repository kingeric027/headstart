<div class="container-fluid mt-4" *ngIf="_product" [hidden]="isLoading">
  <div class="row mb-5">
    <div class="col-md-6">
      <div [hidden]="ShowAddToCart">
        <iframe id="editor-iframe" class="chili-frame" [src]="frameSrc" frameborder="0"></iframe>
      </div>
      <div [hidden]="!ShowAddToCart">
        <img id="proof-image" class="chili-proof" [src]="lineImage" />
      </div>
    </div>
    <div class="col-md-6">
      <div [hidden]="ShowAddToCart">
        <div class="card-body">
          <form ngNoForm>
            <div *ngFor="let spec of chiliTemplate.TemplateSpecs; let i = index">
              <div *ngIf="spec.xp.UI.ControlType == 'Text'">
                <label>{{spec.Name}}</label>
                <input class="form-control" type='text' name="{{spec.Name}}" id="{{spec.ID}}"
                  placeholder="{{spec.Name}}" value="{{spec.DefaultValue}}" (change)="setTecraSpec($event, spec)">
              </div>
              <div *ngIf="spec.xp.UI.ControlType == 'DropDown'">
                <label>{{spec.Name}}</label>
                <select class="form-control" (change)="setTecraSpec($event, spec)">
                  <option selected [ngValue]="null">
                    Select
                  </option>
                  <option *ngFor="let option of spec.Options" [value]="option.Value">
                    {{option.Value}}
                  </option>
                </select>
              </div>
            </div>
          </form>
        </div>
        <div class="card-footer">
          <button class="btn btn-block btn-secondary mb-3" (click)="saveTecraDocument()">
            Save and Continue
          </button>
          <div class="mb-3">
            <a class="btn btn-block btn-dark" href="products/{{_product.ID}}">Back To Product</a>
          </div>
        </div>
      </div>
      <!--Add To Cart-->
      <div *ngIf="ShowAddToCart">
        <div>
          <div class="pb-3 mb-3 border-bottom border-light">
            <a class="d-block my-2" href="javascript:;"
              (click)="setActiveSupplier(_product?.xp.Facets?.supplier && _product?.xp.Facets?.supplier[0])">
              {{_product?.xp.Facets?.supplier && _product?.xp.Facets?.supplier[0]}}
            </a>
            <h1 class="h3 my-0">
              {{ _product.xp?.Facets?.manufacturer && _product.xp?.Facets?.manufacturer[0]}} {{ _product.Name }}
            </h1>
            <ocm-toggle-favorite title="Favorite" (click)="$event.stopPropagation()" [favorite]="isFavorite()"
              (favoriteChanged)="setIsFavorite($event.detail)">
            </ocm-toggle-favorite>
          </div>
          <div *ngIf="supplierNote" class="alert alert-info my-3">
            <b>
            </b><span translate>PRODUCTS.DETAILS.NOTE</span>: {{ supplierNote }}
          </div>
          <div>
            <div>
              <div class="d-flex justify-content-between align-items-center">
                <h4 *ngIf="!showGrid" class="font-weight-bold">
                  {{ price | currency: userCurrency }}
                </h4>
                <p *ngIf="!showGrid" class="text-muted ml-3 float-right">{{ _product | UofM }}</p>
                <!-- TODO: Plug in unit of measure when data is in OC. -->
                <span class="badge badge-pill badge-warning" *ngIf="percentSavings > 0">
                  <span translate>PRODUCTS.DETAILS.SAVINGS</span> {{ percentSavings }}%!
                </span>
              </div>
              <!--DISPLAY SHORT SPEC FORM -->
              <div *ngIf="specs?.length < 4 && !showGrid">
                <ocm-spec-form *ngIf="isOrderable && specs?.length > 0" [superProduct]="_superProduct" [specs]="specs"
                  [disabledVariants]="_disabledVariants" [currency]="_product?.xp?.Currency"
                  (specFormChange)="onSpecFormChange($event.detail)"
                  (isSelectionInactive)="onSelectionInactive($event.detail)">
                </ocm-spec-form>
                <div *ngIf="this.isInactiveVariant">
                  <strong class="text-danger">This option is unavailable and cannot be added to the cart. Please make
                    another selection.</strong>
                </div>
                <div class="d-flex flex-column" *ngIf="isOrderable">
                  <span translate>PRODUCTS.DETAILS.QUANTITY</span>
                  <div class="d-flex flex-row">
                    <ocm-quantity-input class="d-inline-block mb-3 mr-3" (qtyChange)="qtyChange($event.detail)"
                      [product]="_product" [priceSchedule]="_product.PriceSchedule" [gridDisplay]="showGrid"
                      [selectedVariant]="variant" [variantInventory]="variantInventory">
                    </ocm-quantity-input>
                    <button *ngIf="isQuoteProduct()" class="btn btn-block btn-primary mb-3"
                      [disabled]="(specForm && !specForm?.valid) || !qtyValid" (click)="openQuoteForm()" translate>
                      PRODUCTS.DETAILS.REQ_QUOTE
                    </button>
                    <button *ngIf="!isQuoteProduct()" class="btn btn-block btn-primary mb-3" type="submit"
                      [disabled]="isAddingToCart || (specForm && !specForm?.valid)  || !qtyValid || isInactiveVariant"
                      (click)="addToCart()" translate>
                      PRODUCTS.DETAILS.ADD_TO_CART
                    </button>
                  </div>
                  <div>
                    <ocm-modal [state]="quoteFormModal" [modalTitle]="'Request Quote'">
                      <ocm-quote-request-form (formSubmitted)="submitQuoteOrder($event.detail.user)"
                        [CurrentUser]="currentUser" (formDismissed)="dismissQuoteForm()"></ocm-quote-request-form>
                    </ocm-modal>
                    <ocm-modal [state]="contactSupplierFormModal" [modalTitle]="'Product Inquiry'">
                      <ocm-contact-supplier-form
                        (contactFormSubmitted)="submitContactSupplierForm($event.detail.formData)"
                        [CurrentUser]="currentUser" (contactFormDismissed)="dismissContactSupplierForm()">
                      </ocm-contact-supplier-form>
                    </ocm-modal>
                  </div>
                </div>
                <div *ngIf="!isOrderable" class="alert alert-info" translate>
                  PRODUCTS.DETAILS.VIEW_ONLY
                </div>
              </div>
              <div *ngIf="showGrid">
                <ocm-grid-spec-form *ngIf="isOrderable && specs?.length > 0" [specs]="specs" [specForm]="specForm"
                  [superProduct]="_superProduct" [product]="_product" [priceSchedule]="priceSchedule">
                </ocm-grid-spec-form>
              </div>
            </div>
          </div>
          <div *ngIf="priceBreaks && priceBreaks.length > 1">
            <strong><span translate>PRODUCTS.DETAILS.TIERED_PRICE_HEAD</span>: </strong>
            <div class=" border border-medium rounded mb-3 p-2">
              <span translate>PRODUCTS.DETAILS.TIERED_PRICE_DESC</span>
              <div class="d-flex flex-row">
                <span *ngFor="let priceBreak of priceBreaks; let i = index" class="font-weight-bold d-flex mt-2">
                  {{ getPriceBreakRange(i) }}:
                  <p class="font-weight-normal ml-1 mr-4">{{ priceBreak?.Price | currency: userCurrency }}</p>
                </span>
              </div>
            </div>
          </div>
          <div class="alert alert-success my-3" *ngIf="showRequestSubmittedMessage && specForm?.valid && qtyValid">
            <span translate>
              PRODUCTS.DETAILS.SUCCESS
              <button class="btn btn-link" (click)="toOrderDetail()" translate>
                PRODUCTS.DETAILS.VIEW_QUOTE
              </button>
            </span>
          </div>
          <div class="alert alert-success my-3" *ngIf="showContactSupplierFormSubmittedMessage">
            <span translate>
              PRODUCTS.DETAILS.THANK_YOU
            </span>
            <span>
              {{_product?.xp.Facets?.supplier && _product?.xp.Facets?.supplier[0]}}.
            </span>
          </div>
          <strong>
            <span translate>PRODUCTS.DETAILS.DESCRIPTION</span>:
          </strong>
          <div class="p-2 border border-medium rounded">
            <p [innerHTML]="_product.Description || 'This product has no description.' | safeHTML">
            </p>
          </div>
          <div *ngIf="attachments.length > 0">
            <strong><span translate>PRODUCTS.DETAILS.DOCS</span>:</strong>
            <div class="mt-2">
              <a class="border border-medium border-radius p-2 mr-2" *ngFor="let attachment of attachments"
                [href]="attachment.Url" target="_blank" download="attachment.FileName">{{attachment.FileName}}</a>
            </div>
          </div>
          <div class="card-footer footer-btns">
            <div class="mb-3" *ngIf="pdfSrc">
              <a class="btn btn-block btn-info" [href]="pdfSrc" target="_blank">Download PDF</a>
            </div>
            <button class="btn btn-block btn-secondary mb-3" (click)="ShowAddToCart = !ShowAddToCart">
              Edit Document
            </button>
            <div class="mb-3">
              <a class="btn btn-block btn-dark" href="products/{{_product.ID}}">Back To Product</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div [hidden]="!isLoading">
  <ocm-loading-layout height="350px" width="100%" mb="1.5rem" [rows]="3" [columns]="3" [isLoading]="isLoading">
  </ocm-loading-layout>

</div>