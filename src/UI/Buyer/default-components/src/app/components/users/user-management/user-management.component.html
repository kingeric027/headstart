<ocm-profile-nav>
  <h1 class="page-heading border-bottom pb-3">Order Approval Management</h1>
  <div *ngIf="!locations.length">
    <div class="row pt-3 mt-3 bg-white shadow-sm user-permissions-alert">
      <div class="pl-3">
        <p class="font-italic">
          You are an approval rule administrator but you are not currently a part of any locations. When you join a
          location you can assign approval permissions here.
        </p>
      </div>
    </div>
  </div>
  <div *ngIf="locations.length">
    <div *ngFor="let location of locations">{{ location.Name }}</div>
    <!-- User Permissions -->
    <div class="row pt-3 mt-3 bg-white shadow-sm user-permissions-alert">
      <div class="col-md-5">
        <h6>User Order Approval Permissions</h6>
        <p class="font-italic">
          As an approval rule administrator for this location you can set which users will require approval to submit
          orders and which users have the authority to approve those orders.
        </p>
      </div>
      <div class="col-md-7">
        <table class="table table-hover">
          <thead>
            <tr>
              <th scope="col">User</th>
              <th scope="col">Can Approve Orders</th>
              <th scope="col">Orders Need Approval</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>{{ user.Username }}</td>
              <td class="justify-content-start cursor-pointer align-items-center">
                <label class="switch mb-0">
                  <input class="form-check-input"
                         type="checkbox"
                         (click)="toggleAssignment(user.ID, 'OrderApprover')"
                         [checked]="isAssigned(user.ID, 'OrderApprover')" />
                  <span class="slider round"></span>
                </label>
              </td>
              <td class="justify-content-start cursor-pointer align-items-center">
                <label class="switch mb-0">
                  <input class="form-check-input"
                         type="checkbox"
                         (click)="toggleAssignment(user.ID, 'NeedsApproval')"
                         [checked]="isAssigned(user.ID, 'NeedsApproval')" />
                  <span class="slider round"></span>
                </label>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="pb-3">
          <button [disabled]="!areChanges"
                  class="btn btn-link"
                  (click)="discardUserUserGroupAssignmentChanges()">
            {{ areChanges ? 'Cancel' : 'No Changes' }}
          </button>
          <button *ngIf="areChanges && !requestedUserConfirmation"
                  [disabled]="!areChanges || requestedUserConfirmation"
                  class="btn brand-button"
                  (click)="requestUserConfirmation()">
            {{ requestedUserConfirmation ? 'Pending Confirmation' : 'Save Changes' }}
          </button>
          <button *ngIf="requestedUserConfirmation && areChanges"
                  class="btn btn-primary"
                  (click)="executeUserUserGroupAssignmentRequests()">
            Confirm
          </button>
          <div *ngIf="areChanges && requestedUserConfirmation"
               class="mt-3 pb-3 border-top">
            <div class="p-4 border-radius border-primary bg-light">
              <div class="d-flex justify-content-start align-items-center">
                <fa-icon [icon]="faExclamationCircle"
                         class="alert-icon mr-3"></fa-icon>
                <p class="mb-0 d-flex flex-column">
                  <small class="font-weight-bold">This is a potentially destructive action that affects order approvals.</small>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-5 border-top pt-3">
        <h6>Order Approval Threshold</h6>
        <p class="font-italic">
          You have the ability to set an order total above which orders will require approval for the users indicated
          above.
        </p>
      </div>
      <div class="col-md-7 border-top pt-3">
        <div class="btn-group"
             role="group"
             aria-label="Basic example">
          <button type="button"
                  (click)="setThreshold(0)"
                  [ngClass]="{'active' : currentLocationApprovalThresholdEditable === 0}"
                  class="btn btn-outline-primary">All Orders Require Approval</button>
          <button type="button"
                  (click)="setThreshold(currentLocationApprovalThresholdEditable || 100)"
                  [ngClass]="{'active' : !!currentLocationApprovalThresholdEditable}"
                  class="btn btn-outline-primary">Only Orders Over Threshold</button>
        </div>
        <div class="row mt-3">
          <div class="input-group mb-3 col-md-6">
            <div class="input-group-prepend">
              <span class="input-group-text">$</span>
            </div>
            <input type="text"
                   value="{{currentLocationApprovalThresholdEditable}}"
                   class="form-control"
                   (change)="setThresholdFromEvent($event)"
                   aria-label="Amount (to the nearest dollar)">
            <div class="input-group-append">
              <span class="input-group-text">.00</span>
            </div>
          </div>
          <div class="col-md-6">
            <button [disabled]="currentLocationApprovalThresholdEditable === currentLocationApprovalThresholdStatic"
                    class="btn btn-link"
                    (click)="currentLocationApprovalThresholdEditable = currentLocationApprovalThresholdStatic">
              {{ currentLocationApprovalThresholdEditable !== currentLocationApprovalThresholdStatic ? 'Cancel' : 'No Changes' }}
            </button>
            <button *ngIf="currentLocationApprovalThresholdEditable !== currentLocationApprovalThresholdStatic"
                    [disabled]="currentLocationApprovalThresholdEditable === currentLocationApprovalThresholdStatic"
                    class="btn brand-button"
                    (click)="saveNewThreshold()">
              {{ 'Save Changes' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</ocm-profile-nav>