<ng-container>
  <div *ngIf="!showEditor">
    <div class="row">
      <div class="col-md-5">
        <div *ngIf="showChiliDocuments">
          <label translate>ADMIN.PRODUCT_EDIT.SELECT_CHILI_TEMPLATE</label>
          <select class="form-control" (change)="selectChiliTemplate($event)">
            <option selected disabled [ngValue]="null">Select</option>
            <option
              *ngFor="let document of tecraDocuments"
              [value]="document.id"
            >
              {{document.name}}
            </option>
          </select>
        </div>
      </div>
      <div class="col-md-3">
        <div *ngIf="showAvailableCategories">
          <label translate>ADMIN.PRODUCT_EDIT.CATALOG_ASSIGNMENT</label>
          <select class="form-control" (change)="setCatalogSelection($event)">
            <option selected disabled [ngValue]="null">Select</option>
            <option *ngFor="let cat of catalogAssignments" [value]="cat.ID">
              {{cat.Name}}
            </option>
          </select>
        </div>
      </div>
      <div class="col-md-4">
        <div *ngIf="showAssignmentButton">
          <button
            class="btn btn-primary btn-chili"
            type="submit"
            (click)="executeChiliConfigAssignmentRequest()"
            translate
          >
            ADMIN.PRODUCT_EDIT.SAVE_CHILI_CONFIG
          </button>
        </div>
      </div>
    </div>
    <div *ngIf="showChiliConfigs" class="selected-configs">
      <strong translate
        >ADMIN.PRODUCT_EDIT.SELECTED_CHILI_CONFIGURATIONS</strong
      >
      <table
        class="table table-bordered table-condensed table-striped table-hover"
      >
        <tr class="table-row" *ngFor="let config of chiliConfigs">
          <td>
            <div class="row">
              <div class="col-md-5">
                <p>Template: {{config.ChiliTemplateName}}</p>
              </div>
              <div class="col-md-3">
                <p>Catalog: {{config.CatalogID}}</p>
              </div>
              <div class="col-md-4">
                <div class="btn-group" role="group">
                  <button
                    class="btn btn-primary"
                    type="submit"
                    (click)="editChiliTemplate(config.ID)"
                  >
                  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" *ngIf="openingEditor"></span> Edit
                  </button>
                </div>
                <div class="btn-group" role="group">
                  <button
                    class="btn btn-danger"
                    type="submit"
                    (click)="deleteChiliConfig(config)"
                    translate
                  >
                    ADMIN.DELETE.DELETE
                  </button>
                </div>
              </div>
            </div>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div *ngIf="showEditor" id="editorTop">
    <div class="card shadow-sm p-3 table-responsive">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th class="border-0" scope="col">
              Update Template Specs  <button type="button" class="btn btn-link sort-btn" (click)="selectedSpecIndex=50000">Sort Specs...</button>
            </th>
          </tr>
        </thead>
        <tbody [hidden]="selectedSpecIndex == 50000">
          <ng-container *ngFor="let spec of chiliTemplate.TemplateSpecs;let i=index">
            <tr
              cdkDrag
              class="cursor-pointer"
              (click)="toggleTemplateSpec(i)"
              [ngClass]="{'selected-spec-row':selectedSpecIndex==i}"
            >
              <td>{{ spec.Name }}</td>
            </tr>
            <tr class="table-row spec-row" *ngIf="selectedSpecIndex==i">
            <td>
              <div class="spec-edit-div">
                <div class="d-flex justify-content-center loading-div" *ngIf="showLoadingIndicator">
                  <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>
                <div class="row input-group">
                  <div class="col-md-6">
                    <label>Custom Label</label>
                    <input
                      class="form-control"
                      type="text"
                      name="{{spec.ID + '_labelvalue'}}"
                      id="{{spec.ID + '_labelvalue'}}"
                      [value]="spec.xp.Label"
                    />
                  </div>
                  <div class="col-md-6">
                    <label>Default Value</label>
                    <input
                      class="form-control"
                      type="text"
                      name="{{spec.ID + '_defaultvalue'}}"
                      id="{{spec.ID + '_defaultvalue'}}"
                      [value]="spec.DefaultValue"
                    />
                  </div>
                </div>
                <div class="row" *ngIf="spec.xp.UI.ControlType == 'DropDown'">
                  <div class="col-md-6">
                    <div class="spec-options spacer-div" [hidden]="specOptionSortID">
                      <label>Spec Options</label> <button type="button" class="btn btn-link sort-btn" (click)="showOptionsSortOrder(spec)">Sort Options...</button>
                      <div class="input-group" *ngFor="let option of spec.Options">
                        <input
                          class="form-control"
                          type="text"
                          name="{{option.ID + '_option'}}"
                          id="{{option.ID + '_option'}}"
                          [value]="option.Value"
                        />
                        <div class="input-group-append">
                          <button
                            class="btn btn-primary"
                            type="submit"
                            (click)="saveChiliSpecOption(option, spec)"
                          >
                            Save
                          </button>
                          <button
                            class="btn btn-danger"
                            type="submit"
                            (click)="deleteChiliSpecOption(option, spec)"
                          >
                            Delete
                          </button>
                        </div>
                      </div>
                      <div class="spec-options">
                        <label>Add Option</label>
                        <div class="input-group">
                          <input
                            class="form-control"
                            type="text"
                            name="{{spec.ID + '_newOption'}}"
                            id="{{spec.ID + '_newOption'}}"
                          />
                          <div class="input-group-append">
                            <button
                              class="btn btn-primary"
                              type="submit"
                              (click)="saveNewChiliSpecOption(spec)"
                            >
                              Add
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div [hidden]="specOptionSortID != spec.ID" class="spec-options">
                      <label>Options</label>
                      <ol class="sort-list" id="{{spec.ID + '_options'}}">
                        <li *ngFor="let option of spec.Options">{{option.Value}}</li>
                      </ol>
                      <div class="spacer-div btn-group" role="group">
                        <button
                                class="btn btn-primary"
                                type="submit"
                                (click)="saveOptionsOrder(spec)"
                              >
                                Save Sort Order
                              </button>
                        <button
                              class="btn btn-danger"
                              type="submit"
                              (click)="specOptionSortID = null"
                            >
                              Cancel
                            </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row input-group-append" [hidden]="specOptionSortID">
                  <div class="spacer-div">
                    <button
                            class="btn btn-primary"
                            type="submit"
                            (click)="saveChiliSpec(spec)"
                          >
                            Save Changes
                          </button>
                  </div>
                </div>
              </div>
            </td>
          </tr>
          </ng-container>
        </tbody>
        <tbody [hidden]="selectedSpecIndex!=50000">
          <ng-container>
            <tr class="table-row spec-row">
              <td>
                <div class="spec-edit-div">
                  <div class="d-flex justify-content-center loading-div" *ngIf="showLoadingIndicator">
                    <div class="spinner-border" role="status">
                      <span class="sr-only">Loading...</span>
                    </div>
                  </div>
                  <label>Specs</label>
                  <ol class="sort-list" id="templateSpecs">
                    <li *ngFor="let specOrder of chiliSpecSortOrder;let i=index">{{specOrder}}</li>
                  </ol>
                  <div class="spacer-div btn-group" role="group">
                    <button
                            class="btn btn-primary"
                            type="submit"
                            (click)="saveSortOrder()"
                          >
                            Save Sort Order
                          </button>
                    <button
                          class="btn btn-danger"
                          type="submit"
                          (click)="selectedSpecIndex = null"
                        >
                          Cancel
                        </button>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
    <div class="spacer-div">
      <div class="btn-group" role="group">
        <button
          class="btn btn-danger"
          type="submit"
          (click)="showEditor = !showEditor"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>
</ng-container>
